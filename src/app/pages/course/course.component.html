
<div class="text-color mb-24 montserrat">
  <span class="text-color-light underline cursor-pointer montserrat"
    (click)="goTo(schoolData.slug)">{{'Home' | translate}}</span>
  / {{getCourseName(course)}}
</div>

<div class="course-reservation-section">
  <div class="course-section">
    <div class="rounded-8 course-image-wrapper">
      <div class="course-image-text" style="padding: 16px 0;">
        <div
          class="fw-semibold course-image-icon montserrat">
          <img src="assets/icons/prive_ski2x.png"
            *ngIf="course?.course_type==2" />
          <img src="assets/icons/collectif_ski2x.png"
            *ngIf="course?.course_type==1" />
          <!--<ng-container *ngIf="course?.course_type==1">
            {{'colective' | translate }}
          </ng-container>
          <ng-container *ngIf="course?.course_type==2">
            {{'private' | translate }}
          </ng-container>
          <ng-container *ngIf="schoolData && schoolData.sports">
            {{ getSportName(course?.sport_id) }}
          </ng-container>-->
          <div class="text-white fw-semibold text-semibig">
            {{getCourseName(course)}}
          </div>
        </div>
      </div>
      <img [src]="course?.image !== null ? course?.image : defaultImage"
        class="course-image-img" style="border-radius: 20px;" />
    </div>

    <div class="course-content" *ngIf="course">
      <div>
        <span class="descripcion"> a partir de </span>
        <span class="price"> {{course.price}} {{course.currency}} </span>
      </div>
      <div class="dates"
        style="display: flex;gap: 8px;align-items: center;">
        <img src="assets/icons/calendar.png" alt="Calendario" class="icon24">
        <div>
          <span class="descripcion"> Desde </span>
          <span class="campo">{{course.date_start.split("T")[0] }}</span>
          <span class="descripcion"> hasta </span>
          <span class="campo">{{course.date_end.split("T")[0] }}</span>
          <br>
          <span class="campo2">
            {{getWeekDay()}}
            {{findMinHourStart()}}–{{findMaxHourEnd()}}
          </span>
        </div>
      </div>
      <div class="max-group"
        style="display: flex;gap: 8px;align-items: center;">
        <img src="assets/icons/people.png" alt="Grupo máximo" class="icon24">
        <span class="campo2">Max. {{course.max_participants}}</span>
        <span class="campo2" *ngIf="course.age_max<99 && course.age_min>1">
          ,{{course.age_min}}-{{course.age_max}}+ años
        </span>
      </div>

      <!--<ng-container *ngIf="course?.course_type==1">
        <div class="text-color text-medium montserrat course-content-title" *ngIf="course.is_flexible">
          <img [src]="themeService.calendar">
          {{'text_choose_dates' | translate }}
        </div>
        <div class="text-color text-medium montserrat course-content-title" *ngIf="!course.is_flexible">
          <img [src]="themeService.calendar">
          {{'text_availability' | translate }}
        </div>
        <div class="mt-12 course-content-list">
          <div *ngIf="!course.is_flexible">
            <ng-container *ngFor="let date of course?.course_dates">
              <div class="text-color-light pl-32 montserrat"
                *ngIf="date.active || date.active === 1">·
                {{date.date | date: 'dd-MM-yyyy'}}
                {{date.hour_start.substring(0,5) }} -
                {{date.hour_end.substring(0,5)}}</div>
            </ng-container>
          </div>
          <div *ngIf="course.is_flexible">
            <ng-container *ngFor="let date of course?.course_dates">

              <div class="checkbox-circle pl-32"
                *ngIf="(date.active || date.active === 1) && isDateValid(date.date, date.hour_start, date.hour_end)">
                <input
                  id="checkbox-course-{{date.id}}"
                  type="checkbox"
                  *ngIf="course?.is_flexible "
                  (change)="selectDate(date.date)" />
                <label class="text-color-light montserrat"
                  for="checkbox-course-{{date.id}}">
                  {{ date.date | date: 'dd-MM-yyyy' }}
                  {{ date.hour_start.substring(0, 5) }} - {{
                  date.hour_end.substring(0, 5) }}
                </label>
              </div>
            </ng-container>
          </div>

        </div>
      </ng-container>
      <ng-container *ngIf="course?.course_type==2">
        <div class="course-content-flex">
          <div>
            <div class="text-color text-medium montserrat course-content-title">
              <img [src]="themeService.calendar">
              {{'text_when_course' | translate }}
            </div>
            <div class="mt-8 course-content-list">
              <div
                class="text-color-light pl-32 montserrat">{{course?.date_start |
                date: 'dd/MM/yyyy'}} - {{course?.date_end | date:
                'dd/MM/yyyy'}}</div>
              <div class="text-color-light pl-32 montserrat">{{
                getWeekdays(course?.settings) }}</div>
              <div
                class="text-color-light pl-32 montserrat">{{'text_max_participants'
                | translate }}: {{course?.max_participants}}</div>
            </div>
          </div>
          <div>
            <div class="text-color text-medium montserrat course-content-title">
              <img [src]="themeService.clock">
              {{'text_course_duration' | translate }}
            </div>
            <div class="mt-8 course-content-list">
              <div class="text-color-light pl-32 montserrat"
                *ngIf="!course?.is_flexible">{{course?.duration}}</div>
              <div class="text-color-light pl-32 montserrat"
                *ngIf="course?.is_flexible">{{'text_from_price' | translate }}
                {{course?.duration}}</div>
              <div
                class="text-color-light pl-32 montserrat">{{course?.hour_min}}h
                - {{course?.hour_max}}h</div>
            </div>
          </div>
        </div>
      </ng-container>-->
      <span class="descripcion2">
        {{"RESUMEN" |translate}}
      </span>
      <div class="show-desktop text-color-light montserrat"
        [innerHTML]="getShotrDescription(course)">
      </div>

      <span class="descripcion2">
        {{"DESCRIPCIÓN" |translate}}
      </span>
      <div class="show-desktop text-color-light montserrat"
        [innerHTML]="getDescription(course)">
      </div>

      <span class="descripcion2">
        {{"NIVELES" |translate}}
      </span>
      <ng-container *ngFor="let item of course.availableDegrees">
        <span
          style="color: white; width: fit-content;padding: 10px;height: 36px;border-radius: 3px;"
          [style.backgroundColor]="item.color">
          {{item.name}}
        </span>
      </ng-container>

      <ng-container *ngIf="course?.options">
        <span class="descripcion2">
          {{"Forfait" |translate}}
        </span>
        <ng-container *ngFor="let extra of settings.extras.forfait">
          <div class="checkbox-circle pl-32">
            <input
              id="radio-course-{{extra.id}}"
              type="checkbox"
              name="forfaitSelection"
              [checked]="selectedForfait === extra"
              (change)="toggleForfaitSelection(extra)" />
            <label class="text-color-light montserrat"
              for="radio-course-{{extra.id}}">
              {{extra.name}} - {{extra.price}}{{course?.currency}} / {{'date' |
              translate }}
            </label>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </div>

  <!--Reservation-->
  <div class="reservation-section">
    <div class="rounded-8 reservation-box">
      <div *ngIf="!userLogged" class="reservation-box" style="padding: 20px;">
        <div style="width: 100%;" class="text-color montserrat">
          {{'text_booking1' | translate }}
        </div>
        <button
          style="height: 40px;border-radius: 3px;color: white;background-color: #E91E63;font-family: 'DM Sans'"
          class="rounded-8 button-style cursor-pointer width-100"
          type="button"
          (click)="schoolService.isModalLogin=true">
          {{'text_already_client' | translate }}
        </button>
        <button
          style="height: 40px;border-radius: 3px;color: black;background-color: white;font-family: 'DM Sans';border:1px solid black;"
          class="rounded-8 button-style cursor-pointer width-100"
          type="button"
          (click)="schoolService.isModalNewUser = !schoolService.isModalNewUser">
          {{'text_new_client' | translate }}
        </button>
      </div>

      <div *ngIf="userLogged && course">
        <div style="
        color: white;font-size: 16px;font-family: Dinamit;
         font-weight: 500;line-height: 20px;
         word-wrap: break-word; background-color: rgba(47, 56, 68, 1);
         height: 60px;padding: 20px; border-radius: 8px 8px 0 0;">
          {{'text_new_booking' | translate }}
        </div>
        <div
          style="height: 48px; padding: 16px 20px;display: flex;border-bottom: 1px solid rgba(139, 144, 153, 1);align-items: center;">
          <span style="
          font-size: 12px;
          font-family: DM Sans;
          font-weight: 400;
          line-height: 16px;
          word-wrap: break-word"
            [style.color]="courseFlux===0?'#E91E63':'#8B9099'"> PARTICIPANTE
          </span>
          <img src="assets/icons/arrow-right.png" class="icon20">
          <span style="
          font-size: 12px;
          font-family: DM Sans;
          font-weight: 400;
          line-height: 16px;
          word-wrap: break-word"
            [style.color]="courseFlux===1?'#E91E63':'#8B9099'"> NIVEL </span>
          <img src="assets/icons/arrow-right.png" class="icon20"
            *ngIf="course.is_flexible">
          <span
            *ngIf="course.is_flexible"
            style="
            font-size: 12px;
            font-family: DM Sans;
            font-weight: 400;
            line-height: 16px;
            word-wrap: break-word"
            [style.color]="courseFlux===2?'#E91E63':'#8B9099'"> FECHA </span>
          <img src="assets/icons/arrow-right.png" class="icon20">
          <span style="
              font-size: 12px;
              font-family: DM Sans;
              font-weight: 400;
              line-height: 16px;
              word-wrap: break-word"
            [style.color]="courseFlux===3?'#E91E63':'#8B9099'"> EXTRAS </span>
        </div>
        <div class="reservation-users" style="padding: 20px;"
          *ngIf="courseFlux===0">
          <div style="
          color: #222222;
           font-size: 14px;
           font-family: DM Sans;
           font-weight: 400;
           line-height: 18px;
           word-wrap: break-word">
            <ng-container *ngIf="course?.course_type === 2">
              {{'text_select_user_or_more' | translate }}
              {{course?.max_participants}}
            </ng-container>
            <ng-container *ngIf="!(course?.course_type === 2)">
              {{'text_select_user' | translate }}
            </ng-container>
          </div>

          <mat-checkbox
            (click)="selectUser(userLogged.clients[0],course?.course_type)"
            style="color: #222222;font-size: 14px;font-family: DM Sans;font-weight: 600;line-height: 18px;word-wrap: break-word;height: 64px;width: 100%;border-radius: 3px;border: 1px solid rgba(34, 34, 34, 1);">
            <div style="display: flex;gap: 8px;padding: 12px;">
              <app-level-user *ngIf="dataLevels && dataLevels.length"
                [allLevels]="dataLevels" [selectLevel]="185" [size]="40"
                [userImage]="userLogged?.clients[0].image"></app-level-user>
              <div
                class="text-color text-small montserrat reservation-user-title">
                <img src="assets/images/gold-crown.png">
                {{userLogged?.clients[0].last_name}}
              </div>
              <div
                *ngIf="(course?.course_type === 2 && selectedUserMultiple.includes(userLogged?.clients[0])) || (!(course?.course_type === 2) && selectedUser === userLogged?.clients[0])"
                class="reservation-user-bullet"></div>
            </div>
          </mat-checkbox>

          <div class="reservation-user-box cursor-pointer"
            *ngFor="let utilizer of userLogged?.clients[0].utilizers"
            (click)="selectUser(utilizer,course?.course_type)"
            [ngClass]="{'opacity-full': (course?.course_type === 2 && selectedUserMultiple.includes(utilizer)) || (!(course?.course_type === 2) && selectedUser === utilizer)}">
            <app-level-user *ngIf="dataLevels && dataLevels.length"
              [allLevels]="dataLevels" [selectLevel]="182" [size]="70"
              [userImage]="themeService.avatarEmpty"></app-level-user>
            <div
              class="text-color text-small montserrat reservation-user-title">
              {{utilizer.last_name}}
            </div>
            <div
              *ngIf="(course?.course_type === 2 && selectedUserMultiple.includes(utilizer)) || (!(course?.course_type === 2) && selectedUser === utilizer)"
              class="reservation-user-bullet"></div>
          </div>

          <button (click)="openModalAddUser()"
            style="color: #222222;font-size: 14px;font-family: DM Sans;font-weight: 600;line-height: 18px;word-wrap: break-word;height: 40px;padding: 10px;width: 100%;border-radius: 3px;border: 1px solid rgba(34, 34, 34, 1);">
            {{'text_add' | translate }} {{'text_user' | translate }}
          </button>
        </div>

        <!--COLLECTIVE-->
        <div *ngIf="course?.course_type==1 && courseFlux===1"
          style="padding: 20px;">
          <div style="
          color: #222222;
           font-size: 14px;
           font-family: DM Sans;
           font-weight: 400;
           line-height: 18px;
           word-wrap: break-word">
            {{'text_select_level' | translate }}
          </div>
          <div *ngIf="!selectedLevel"
            style="
            background-color: rgba(210, 239, 255, 1);
          color: #222222;
           font-size: 14px;
           font-family: DM Sans;
           font-weight: 400;border-radius: 8px;margin-top: 12px; margin-bottom: 20px;
           line-height: 18px; padding: 10px;display: flex;gap: 8px; align-items: center;
           word-wrap: break-word">
            <img src="assets/icons/info.png" alt class="icon24">
            {{ 'text_no_level' | translate }}
          </div>

          <div>

            <!--<div *ngIf="selectedLevel" class="rounded-8 level-wrapper"
              (mouseenter)="showTooltipFilter(0)"
              (mouseleave)="hideTooltipFilter(0)">
              <div
                [ngStyle]="{'color': selectedLevel.color}">{{selectedLevel.league}}</div>
              <div class="text-color">{{selectedLevel.name}}</div>
              <div class="level-check">
                <img src="assets/icons/check.png" />
              </div>

              <div class="tooltip-container-level background-color-trans"
                *ngIf="tooltipsFilter[0]" [@fadeInOut]>
                <div class="text-small montserrat text-color-light"
                  *ngFor="let goal of selectedLevel.degrees_school_sport_goals">
                  {{goal.name}}
                </div>
              </div>
            </div>

            <div
              class="text-color montserrat cursor-pointer reservation-return mt-24 mb-24"
              (click)="showLevels=!showLevels">
              <img [src]="themeService.edit">
              {{'text_change_level' | translate }}
            </div>-->

            <div
              *ngIf="showLevels && course?.availableDegrees && course?.availableDegrees.length > 0"
              class="levels-section">
              <ng-container
                *ngFor="let level of course?.availableDegrees;let i = index">
                <div
                  *ngIf="i===0 || course?.availableDegrees[i].level !== course?.availableDegrees[i-1].level"
                  style="
                color: #8B9099;
                 font-size: 12px;
                 font-family: DM Sans;
                 font-weight: 600;
                 line-height: 16px;
                 word-wrap: break-word">
                  {{level.level }}
                </div>

                <mat-checkbox
                  *ngIf="isAgeAppropriate(transformAge(selectedUser.birth_date), level.age_min, level.age_max) &&
                       hasMatchingSportLevel(level)"
                  style="color: #222222;font-size: 14px;font-family: DM Sans;font-weight: 600;line-height: 18px;word-wrap: break-word;width: 100%;border-radius: 3px;border: 1px solid rgba(34, 34, 34, 1);"
                  [ngStyle]="{'background-color': level.color+'33','border': '1px solid '+level.color}">
                  <div style="display: flex;gap: 8px;">
                    <div
                      [ngStyle]="{'color': level.color}"
                      style="
                       font-size: 12px;
                       font-family: DM Sans;
                       font-weight: 400;
                       line-height: 16px;
                       word-wrap: break-word">
                      {{level.annotation}} {{level.name}}
                    </div>
                    <div *ngIf="level == selectedLevel" class="level-check">
                      <img src="assets/icons/check.png" />
                    </div>
                  </div>
                </mat-checkbox>
              </ng-container>
            </div>
            <div
              *ngIf="showLevels && course?.availableDegrees && course?.availableDegrees.length && !hasLevelsAvailable">
              <p> {{'text_no_degrees' | translate }}</p>
            </div>
          </div>
        </div>

        <!--PRIVATE-->
        <ng-container *ngIf="course?.course_type==2">

          <ng-container
            *ngIf="selectedUserMultiple && selectedUserMultiple.length">
            <div class="text-color montserrat mt-12 margin-auto">
              {{'text_select_date_disponibility' | translate }}
            </div>

            <!--Calendar Private-->
            <div class="calendar-reservation-section margin-auto">
              <div class="calendar background-color-trans rounded-8">
                <div class="header-calendar">
                  <div class="header-calendar-arrows">
                    <img [src]="themeService.arrowLeft" (click)="prevMonth()" />
                    <img [src]="themeService.arrowRight"
                      (click)="nextMonth()" />
                  </div>
                  <div class="text-color text-semibig fw-medium">{{
                    monthNames[currentMonth] }}</div>
                  <div class="text-color text-semibig fw-medium">{{ currentYear
                    }}</div>
                </div>
                <div class="weekdays">
                  <span *ngFor="let day of weekdays"
                    class="montserrat text-small text-color-light">{{ day
                    }}</span>
                </div>
                <div class="days">
                  <ng-container *ngFor="let day of days">
                    <span [ngClass]="{'very-light-opacity': day.past}"
                      class="montserrat day-span-a"
                      (click)="selectDay(day)">
                      <span [ngClass]="{
                                                'active-collective': day.active && course.course_type == 1,
                                                'active-collective-selected': day.selected && course.course_type == 1,
                                                'active-private': day.active  && course.course_type == 2,
                                                'active-private-selected': day.selected  && course.course_type == 2
                                                }"
                        class="day-span-b text-color">
                        {{ day.number }}
                      </span>
                    </span>
                  </ng-container>
                </div>
              </div>
            </div>

            <ng-container *ngIf="selectedDateReservation">
              <div class="calendar-reservation-form">
                <div
                  class="text-color text-medium montserrat cursor-pointer reservation-return mt-12 mb-24 margin-auto">
                  <img [src]="themeService.calendar">
                  {{selectedDateReservation}}
                </div>

                <div class="text-color montserrat margin-auto">
                  {{'text_select_hour_date' | translate }}
                </div>

                <div class="text-color-light montserrat mt-12 margin-auto">
                  {{'text_hour' | translate }}
                </div>
                <select
                  class="form-control margin-auto calendar-reservation-form-input"
                  [(ngModel)]="selectedHour"
                  (change)="course?.is_flexible && updateAvailableDurations(selectedHour)">
                  <option *ngFor="let hour of availableHours" [value]="hour">{{
                    hour }}</option>
                </select>

                <!--
                <div class="text-color-light montserrat mt-12 margin-auto">
                  {{'text_people' | translate }}
                </div>
                <select class="form-control margin-auto calendar-reservation-form-input" [(ngModel)]="selectedPaxes"
                        (change)="updatePrice()">
                  <option *ngFor="let number of generateNumberArray(course.max_participants)" [value]="number">{{ number }}</option>
                </select>
                -->

                <div class="text-color-light montserrat mt-12 margin-auto">
                  {{'text_duration' | translate }}
                </div>
                <ng-container *ngIf="course?.is_flexible">
                  <select
                    class="form-control margin-auto calendar-reservation-form-input"
                    [(ngModel)]="selectedDuration"
                    (change)="updatePrice()">
                    <option *ngFor="let range of availableDurations"
                      [value]="convertToHoursAndMinutes(range)">{{convertToHoursAndMinutes(range)}}</option>
                  </select>
                </ng-container>
                <ng-container *ngIf="!course?.is_flexible">
                  <select
                    class="form-control margin-auto calendar-reservation-form-input"
                    [(ngModel)]="selectedDuration">
                    <option
                      [value]="course?.duration">{{course?.duration}}</option>
                  </select>
                </ng-container>
              </div>

              <div class="reservation-price-flex mt-12">
                <div class="text-medium text-color uppercase">
                  {{'text_price' | translate }}
                </div>
                <div class="text-medium text-color">
                  <span class="text-color text-medium fw-bold">
                    {{course?.price}}</span> {{ course?.currency }}
                </div>
              </div>
              <div>
                <button (click)="addBookingToCart()"
                  class="btn-back-primary rounded-8 button-style-icon cursor-pointer width-100 mb-12"
                  type="button">
                  <img src="/assets/icons/cart.svg"> {{'text_add_to_cart' |
                  translate }}
                </button>
              </div>

            </ng-container>

          </ng-container>

        </ng-container>

        <ng-container *ngIf="course?.course_type ==1">
          <div class="reservation-price-flex"
            style="padding: 10px 20px; border-top: 1px solid rgba(222, 230, 234, 1); border-bottom: 1px solid rgba(222, 230, 234, 1);">
            <div class="text-medium text-color uppercase">
              {{'text_price' | translate }}
            </div>
            <div class="text-medium text-color" *ngIf="!course?.is_flexible">
              <span class="text-color text-medium fw-bold">
                {{course?.price}}</span> {{ course?.currency }}
            </div>
            <div class="text-medium text-color" *ngIf="course?.is_flexible">
              <span class="text-color text-medium fw-bold">
                {{collectivePrice}}</span> {{ course?.currency }} /{{'date' |
              translate }}
            </div>
          </div>
          <div style="padding: 20px;">
            <button
              (click)="next()"
              [disabled]="!selectedUser && !selectedLevel"
              style="
              background-color: rgba(233, 30, 99, 1);
              width: 100%;border-radius: 3px;
              height: 50px;padding: 10px 12px;
              color: white;
               font-size: 14px;
               font-family: DM Sans;
               font-weight: 600;
               line-height: 18px;
               word-wrap: break-word"
              type="button">
              {{'Continuar' | translate }}
            </button>
          </div>
        </ng-container>
        <!--<div (click)="goTo(schoolData.slug )"
          class="text-color-light montserrat cursor-pointer reservation-return mt-12">
          <img [src]="themeService.arrowReturn">
          {{'text_delete_return_courses' | translate }}
        </div>-->

      </div>
      <!--/USER LOGGED-->

    </div>
  </div>
</div>

<app-modal-add-user [slug]="schoolData?.slug" [isOpen]="isModalAddUser"
  (onClose)="closeModalAddUser()"></app-modal-add-user>
