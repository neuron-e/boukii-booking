<app-header></app-header>

<div (click)="goBack('home')" class="text-color-light montserrat cursor-pointer reservation-return" style="display: flex;align-items: center;gap: 12px;">
    <img [src]="themeService.arrowReturn">
    {{'text_continue' | translate }}
</div>

<mat-spinner *ngIf="loading" style="margin: 0 auto"></mat-spinner>

<mat-tab-group (selectedIndexChange)="onTabChange($event)" *ngIf="!loading">
  <mat-tab label="{{'data' | translate}}">
    <app-user-detail #userDetail (idChange)="handleIdChange($event)"></app-user-detail>
  </mat-tab>
  <mat-tab label="{{'sports' | translate}}">

    <div class="container py-6" style="max-width: none" *ngIf="!loading">
      <div class="card overflow-hidden">
        <div class="h-64 relative overflow-hidden">
          <img
            class="w-full h-full object-cover"
            src="../../../../assets/images/8.png" />
          <div
            class="absolute bg-black opacity-25 top-0 right-0 bottom-0 left-0 w-full h-full z-0"></div>
        </div>

        <div class="z-10 relative -mt-16 px-6 flex items-center" style="margin-top: -6rem !important;position: relative;bottom: 80px;display: flex;align-items: center;gap: 24px;padding-left: 1.5rem;padding-right: 1.5rem;" >
          <img
            class="avatar h-24 w-24 flex-none align-start sm:block border-2 border-white"
            [src]="defaults.image" style="border: 2px solid rgb(255 255 255) !important;position:static !important;" />
            <div class="h-16" style="display: flex;flex-direction: column;gap: 12px;">
              <div class="headline text-white montserrat" style="font-size: 12px;color:#fff !important;line-height: 1.2;">{{getLanguage(defaults.language1_id)}} · {{getCountry(defaults.country)}} · {{calculateAge(defaults.birth_date)}}  &ensp;{{'years' | translate }}</div>

              <div class="headline text-white" style="font-size: 18px;color:#fff !important;line-height: 1.2;">{{defaults.first_name}} {{defaults.last_name}}</div>

              <!-- añadir icono aqui-->
              <!-- añadir icono aqui-->
              <!-- añadir icono aqui-->
            </div>
        </div>
      </div>

      <div class="flex-sections-user">

        <div class="mt-6 flex flex-col md:flex-row md:items-start flex-sections-user-left" *ngIf="!loading">

          <div style="margin-left:0; margin-right: 1.5rem;max-width: initial !important;" class="card max-w-unset md:max-w-xs w-full flex-none md:ltr:ml-6 md:rtl:mr-6 mt-6 md:mt-0">
            <div class="px-6 py-4 border-b">
              <h2 class="title m-0">{{'users' | translate }}</h2>
            </div>

            <div class="px-6 py-4 flex flex-col gap-4" style="cursor:pointer;">
              <div
                class="flex items-center" (click)="changeClientData(userLogged.clients[0].id)" style="display:flex;width:100%;align-items:center;gap:10px;padding-left: 1.5rem;padding-right: 1.5rem;padding-top: 1rem;padding-bottom: 1rem;">
                <img
                  [src]="userLogged.clients[0]?.image === null || userLogged.clients[0]?.image === '' ? '../../../../assets/img/avatar.png': userLogged.clients[0]?.image"
                  [ngStyle]="{
                    'border': mainId == id ? '#FF3085 1px solid' : 'none'
                  }"
                  alt="Profile Picture"
                  class="avatar ltr:mr-3 rtl:ml-3 flex-none" style="position:static !important;height: 2.5rem !important;width: 2.5rem !important;" />

                  <div class="body-2 m-0 leading-snug montserrat" style="font-size:13px;color:black">{{ userLogged.clients[0]?.first_name }} {{ userLogged.clients[0]?.last_name }}</div>
              </div>
              <div
                *ngFor="let user of clientUsers"
                class="flex items-center" style="cursor:pointer;" (click)="changeClientData(user.id)" style="display:flex;width:100%;align-items:center;gap:10px;padding-left: 1.5rem;padding-right: 1.5rem;padding-top: 1rem;padding-bottom: 1rem;">
                <img
                  [src]="user?.image === null || user?.image === '' ? '../../../../assets/img/avatar.png': user?.image"
                  alt="Profile Picture"
                  class="avatar ltr:mr-3 rtl:ml-3 flex-none"
                  [ngStyle]="{
                    'border': user.id === id && id !== mainId ? '#FF3085 1px solid' : 'none'
                  }"
                  style="position:static !important;height: 2.5rem !important;width: 2.5rem !important;" />
                  <div class="body-2 m-0 leading-snug montserrat" style="font-size:13px;color:black">{{ user?.first_name }} {{ user?.last_name }}</div>
              </div>

              <div style="cursor:pointer"
                class="flex items-center">
                <!--<mat-icon svgIcon="mat:add"></mat-icon>
                <div class="flex-auto" (click)="addUtilisateur()">
                  <h4 class="body-2 m-0 leading-snug">{{'add_user' | translate }}</h4>
                </div>-->
              </div>


            </div>
          </div>

        </div>
        <div class="mt-6 flex flex-col md:flex-row md:items-start flex-sections-user-right" *ngIf="!loading">
          <div class="flex-auto">
          <div class="card">
            <div class="px-6 py-4 border-b">
              <h2 class="title m-0">{{'sport_evolution' | translate }}
              </h2>
            </div>

            <div class="px-6 py-4 grid grid-cols-1 sm:grid-cols-2 gap-4" style="border-bottom: 1px solid #ededed; padding:5%">
              <div class="py-3 flex items-center">
                <div style="width:100%;display:flex;gap:12px;align-items:flex-start;">
                  <div style="display:flex;flex-direction:column;gap:6px;justify-content:center;align-items:center;" *ngFor="let item of clientSport" (click)="selectSportEvo(item)">
                    <img [src]="selectedSport?.sport_id === item.sport_id ? item.icon_selected : item.icon_unselected" style="float: left;border-radius: 20%;border:1px solid; cursor:pointer;"
                    [ngStyle]="{
                      'background': selectedSport?.sport_id === item.sport_id ? '#e91e63' : '#e6e6e6',
                      'border': selectedSport?.sport_id === item.sport_id ? '#fff' : '#808080'
                    }">
                    <p style="text-align: center;font-size:14px;text-wrap: nowrap;" class="montserrat"> {{item.name}}</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="px-6 py-4 grid grid-cols-1 sm:grid-cols-2 gap-4" style="border-bottom: 1px solid #ededed; padding:5%;display: flex;align-items: center;justify-content: space-between;gap: 24px;">
              <div class="py-3 flex items-center">
                <div style="float: left; width:100%;">
                  <div style="float: left; width:100%;">
                    <div style="float: left; width:20%;">
                      <img [src]="selectedSport?.icon_selected" [style.background]="selectedSport?.level?.color" [style.border]="selectedSport?.level?.color" style="float: left;border-radius: 20%;border:1px solid">
                    </div>
                    <div style="float: left; width:80%;">
                      <p style="float: left; width:100%;font-size: 12px;color:black;">{{selectedSport?.level?.league}} - {{calculateGoalsScore() === 0 ? 0 : calculateGoalsScore() / this.selectedGoal.length}}%</p>
                      <h1 style="float: left; width:100%;font-size: 20px;color:black;">{{selectedSport?.level?.annotation}} / {{selectedSport?.level?.name}}</h1>
                    </div>

                    <div style="float: left; width:100%;margin: 2% 0 0 0;">
                      <mat-progress-bar mode="determinate" [value]="calculateGoalsScore()" [color]="selectedSport?.level?.color"></mat-progress-bar>

                    </div>

                    <div style="float: left; width:100%;margin: 4% 0 0 0;" *ngFor="let goal of selectedGoal">

                      <div style="float: left; width:3%;margin-right: 15px;">
                        <!-- añadir icono aqui-->
                      </div>

                      <div style="float: left; width:80%;">
                        <div class="montserrat" style="color:black;">{{goal.name}} </div>
                      </div>

                      <div style="float: left; width:5%;margin-right: 15px;">
      <!-- añadir icono aqui-->
                      </div>

                      <div style="float: left; width:5%;margin-right: 15px;">
      <!-- añadir icono aqui-->
                      </div>

                      <div style="float: left; width:5%;">
      <!-- añadir icono aqui-->
                      </div>

                    </div>
                  </div>



                  <div style="float: left; width:100%;margin-top: 5%" *ngIf="false">
                    <h1 style="float: left; width:100%;font-size: 20px;">{{'historical' | translate }}</h1>

                  </div>

                </div>

              </div>
              <div class="py-3 flex items-center">

                <div style="float: left; width:100%;">
                  <app-level-user *ngIf="!coloring" [allLevels]="allLevels" [selectLevel]="selectedSport?.level?.id" [size]="150" [userImage]="userLogged.clients[0].image"></app-level-user>

                </div>
              </div>
            </div>
          </div>
          </div>
        </div>

      </div>

    </div>
  </mat-tab>
  <mat-tab label="{{'bookings' | translate }}">

    <div class="container py-6" style="max-width: none" *ngIf="!loading">
      <div class="card overflow-hidden">
        <div class="h-64 relative overflow-hidden">
          <img
            class="w-full h-full object-cover"
            src="../../../../assets/images/8.png" />
          <div
            class="absolute bg-black opacity-25 top-0 right-0 bottom-0 left-0 w-full h-full z-0"></div>

        </div>

        <div class="z-10 relative -mt-16 px-6 flex items-center" style="margin-top: -6rem !important;position: relative;bottom: 80px;display: flex;align-items: center;gap: 24px;padding-left: 1.5rem;padding-right: 1.5rem;" >
          <img
            class="avatar h-24 w-24 flex-none align-start sm:block border-2 border-white"
            [src]="defaults.image" style="border: 2px solid rgb(255 255 255) !important;position:static !important;" />
            <div class="h-16" style="display: flex;flex-direction: column;gap: 12px;">
              <div class="headline text-white montserrat" style="font-size: 12px;color:#fff !important;line-height: 1.2;">{{getLanguage(defaults.language1_id)}} · {{getCountry(defaults.country)}} · {{calculateAge(defaults.birth_date)}}  &ensp;{{'years' | translate }}</div>

              <div class="headline text-white" style="font-size: 18px;color:#fff !important;line-height: 1.2;">{{defaults.first_name}} {{defaults.last_name}}</div>

              <!-- añadir icono aqui-->
              <!-- añadir icono aqui-->
              <!-- añadir icono aqui-->
            </div>
        </div>

      </div>


      <div class="flex-sections-user">

        <div class="mt-6 flex flex-col md:flex-row md:items-start flex-sections-user-left" *ngIf="!loading && !selectedBooking">

          <div style="margin-left:0; margin-right: 1.5rem;max-width: initial !important;" class="card max-w-unset md:max-w-xs w-full flex-none md:ltr:ml-6 md:rtl:mr-6 mt-6 md:mt-0">
            <div class="px-6 py-4 border-b">
              <h2 class="title m-0">{{'users' | translate }}</h2>
            </div>

            <div class="px-6 py-4 flex flex-col gap-4" style="cursor:pointer;">
              <div
                class="flex items-center" (click)="changeClientData(userLogged.clients[0].id)" style="display:flex;width:100%;align-items:center;gap:10px;padding-left: 1.5rem;padding-right: 1.5rem;padding-top: 1rem;padding-bottom: 1rem;">
                <img
                  [src]="userLogged.clients[0]?.image === null || userLogged.clients[0]?.image === '' ? '../../../../assets/img/avatar.png': userLogged.clients[0]?.image"
                  [ngStyle]="{
                    'border': userLogged.clients[0].id && +userLogged.clients[0].id === id ? '#FF3085 1px solid' : 'none'
                  }"
                  alt="Profile Picture"
                  class="avatar ltr:mr-3 rtl:ml-3 flex-none" style="position:static !important;height: 2.5rem !important;width: 2.5rem !important;" />

                  <div class="body-2 m-0 leading-snug montserrat" style="font-size:13px;color:black">{{ userLogged.clients[0]?.first_name }} {{ userLogged.clients[0]?.last_name }}</div>
              </div>
              <div
                *ngFor="let user of clientUsers"
                class="flex items-center" style="cursor:pointer;" (click)="changeClientData(user.id)" style="display:flex;width:100%;align-items:center;gap:10px;padding-left: 1.5rem;padding-right: 1.5rem;padding-top: 1rem;padding-bottom: 1rem;">
                <img
                  [src]="user?.image === null || user?.image === '' ? '../../../../assets/img/avatar.png': user?.image"
                  alt="Profile Picture"
                  class="avatar ltr:mr-3 rtl:ml-3 flex-none"
                  [ngStyle]="{
                    'border': user.id === id && id !== userLogged.clients[0].id ? '#FF3085 1px solid' : 'none'
                  }"
                  style="position:static !important;height: 2.5rem !important;width: 2.5rem !important;" />
                  <div class="body-2 m-0 leading-snug montserrat" style="font-size:13px;color:black">{{ user?.first_name }} {{ user?.last_name }}</div>
              </div>

              <div style="cursor:pointer"
                class="flex items-center">
                <!--<mat-icon svgIcon="mat:add"></mat-icon>
                <div class="flex-auto" (click)="addUtilisateur()">
                  <h4 class="body-2 m-0 leading-snug">{{'add_user' | translate }}</h4>
                </div>-->
              </div>


            </div>
          </div>

        </div>
        <div class="mt-6 flex flex-col md:flex-row md:items-start flex-sections-user-right" *ngIf="!loading && !selectedBooking">
          <div class="flex-auto">
            <table *ngIf="dataSource" mat-table [dataSource]="dataSource" class="mat-elevation-z8">

              <ng-container matColumnDef="bookingusers[0].course.name">
                <th mat-header-cell *matHeaderCellDef> Course Name </th>
                <td mat-cell *matCellDef="let element" (click)="selectBooking(element.id)"> {{getCourseName(element.bookingusers[0]?.course) || 'N/A'}} </td>
              </ng-container>

              <ng-container matColumnDef="price_total">
                <th mat-header-cell *matHeaderCellDef> Price </th>
                <td mat-cell *matCellDef="let element" (click)="selectBooking(element.id)"> {{element.price_total}} CHF</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;" style="cursor: pointer;"></tr>
            </table>
          </div>
        </div>

        <div style="width:100%;">
          <vex-booking-detail [hidden]="!selectedBooking" (closeBooking)="hideBooking()" [bookingId]="bookingId" [bookingSelectionChanged]="bookingSelectionChanged"></vex-booking-detail>
        </div>

      </div>
    </div>
  </mat-tab>
</mat-tab-group>

