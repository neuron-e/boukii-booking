<div class="card">
  <div class="card-header">
    <img [src]="data.image || '../../../assets/images/3.png'" alt="Imagen de esquiadores" class="card-image">
    <div class="left-icon">
      <img [src]="data.icon" alt="Icono">
    </div>
    <div class="favorite-icon" *ngIf="data.highlited">
      <img src="assets/icons/destacado.png" alt="Favorito">
    </div>
    <span class="last-plaza" *ngIf="data.claim_text">
      {{data.claim_text | translate}}
    </span>
  </div>
  <div class="card-body">
    <h3 class="card-title">{{getCourseName()}}</h3>
    <p class="price">
      {{ (data.is_flexible ? 'text_from' : '') | translate }}
      {{ (data.course_type !== 1 && data.is_flexible ? getCoursePrivateFlexPrice(data.minDuration) : getCoursePrice()) | number: '0.2-2' }}
      {{ data.currency }} /
      {{ (data.course_type !== 1 && data.is_flexible ? ('mails.course' | translate: { duration: data.minDuration }) : ('mails.course' | translate)) }}
    </p>
    <p [innerHTML]="getShotrDescription()" class="description"></p>

    <!-- Sección de fechas -->
    <div class="dates">
      <img src="assets/icons/calendar.png" alt="Calendario" class="icon">
      <div class="dates-container">

        <!-- 1. Cursos con intervalos: Mostrar por intervalos -->
        <ng-container *ngIf="shouldDisplayByIntervals()">
          <div class="date-intervals-list">
            <div *ngIf="getIntervalGroups().length === 0" class="no-dates">
              {{ 'no_future_dates' | translate }}
            </div>
            <div *ngFor="let group of getIntervalGroups()" class="date-interval-item">
              <div class="interval-info">
                <strong>{{ group.name }}:</strong>
                {{ group.startDate | date: 'dd.MM.yyyy' }} - {{ group.endDate | date: 'dd.MM.yyyy' }}
                ({{ formatWeekdays(group.weekdays) }})
                <span *ngIf="group.time" class="time-info">{{ group.time }}</span>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- 2. Cursos flexibles sin intervalos: Agrupar por semanas -->
        <ng-container *ngIf="shouldDisplayByWeeks()">
          <div class="date-weeks-list">
            <div *ngIf="getWeekGroups().length === 0" class="no-dates">
              {{ 'no_future_dates' | translate }}
            </div>
            <div *ngFor="let group of getWeekGroups()" class="date-week-item">
              <div class="week-info">
                <strong>{{ 'week_of' | translate }}:</strong>
                {{ group.startDate | date: 'dd.MM.yyyy' }} - {{ group.endDate | date: 'dd.MM.yyyy' }}
                ({{ formatWeekdays(group.weekdays) }})
                <span *ngIf="group.time" class="time-info">{{ group.time }}</span>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- 3. Cursos no flexibles sin intervalos: Mostrar fechas individuales (como antes) -->
        <ng-container *ngIf="shouldDisplaySimpleDates()">
          <span style="width: max-content; display: flex; flex-direction: column;">
            <ng-container *ngFor="let date of getFutureDates()">
              <span style="display: flex; justify-content: space-between;">
                <span style="font-weight: 600;">
                  {{date.date | date: 'dd.MM.yyyy'}}
                </span>
                <span style="color: #8B9099;">
                  {{date.hour_start}}h-{{date.hour_end}}h
                </span>
              </span>
            </ng-container>

            <div *ngIf="getFutureDates().length === 0" class="no-dates">
              {{ 'no_future_dates' | translate }}
            </div>
          </span>
        </ng-container>

        <!-- Para cursos privados (misma estructura que antes) -->
        <ng-container *ngIf="data.course_type == 2">
          <div class="private-course-dates">
            <div class="date-range-info">
              {{'text_from'|translate}} <strong>{{data.date_start | date: 'dd.MM.yyyy'}}</strong>
              {{'text_till'|translate}} <strong>{{data.date_end | date: 'dd.MM.yyyy'}}</strong>
            </div>

            <div class="weekdays-info">
              {{getWeekdays(data.settings)}}
            </div>

            <div class="duration-info">
              {{'text_from_price' | translate}} {{data.duration}}
            </div>

            <div class="hours-info">
              {{data.hour_min}}h-{{data.hour_max}}h
            </div>
          </div>
        </ng-container>

      </div>
    </div>

    <div class="max-group">
      <img src="assets/icons/people.png" alt="Grupo máximo" class="icon">
      <span>
        {{"max_pax"|translate}} {{data.max_participants}}
      </span>
      <span *ngIf="data.age_max<99 && data.age_min>1">
        ,{{data.age_min}}-{{data.age_max}}+ {{"years"|translate}}
      </span>
    </div>
  </div>
</div>
